# Structure

This app consists of multiple services that run together using docker. Application itself is programmed in PHP language.

# App Programming

The meat of your project resides in `app` directory which itself is a parent directory for `common` and `services`. All
the files in `common` directory are copied into each service built during the build time and includes core components of
your project such as kernel, database schemas and ORM models that are required by other services to function properly.

```
.      
├── app                       
│   ├── common                # All the common PHP modules that are copied into services during build
│   ├── services              # Docker Services
│   │   ├── admin             # Administration Panel API Server
│   │   ├── db                # Databases (MySQL 5.7)
│   │   ├── engine            # Engine for your app (contains executables for CLI and crons)
│   │   ├── public            # Public API Server
│   │   └── redis             # Redis (Caching Engine Service)
```

## App Service

This app primarily contains 3 services (not including database and caching servers):

Service | Directory | Description
--- | --- | ---
admin_api | `./app/services/admin` | Administration API Service
engine | `./app/services/engine` | Engine for your app (contains executables for CLI and crons)
public_api | `./app/services/public` | Public API Server

A minimal directory structure for a service is as follows:

```
.      
├── app                       
│   ├── services
│   │   ├── engine
│   │   │   ├── common                # Copy of `common` directory
│   │   │   ├── src                   # Sources
│   │   │   │   └── */*.php
│   │   │   ├── vendor                # vendor directory generated by Composer
│   │   │   ├── composer.json
│   │   │   ├── Dockerfile
│   │   │   └── entrypoint.sh
```

* **common**: is a copied from actual common directory at path `./app/common` during build and contains most common
  components of your app such as kernel, DB schemas, ORM models and other objects.
* **src**: contains PHP files unique to this service; these files are only available in said service such as
  controllers/endpoints or other scripts.
* **vendor**: this directory is generated automatically by Composer. The `composer install` command is ran during build
  time which also generates a `composer.lock` file.
* **composer.json**: this file includes all prerequisites to be pulled using Composer and also defines PSR-4 spec
  namespaces.
* **Dockerfile**: this file contains Docker build instructions for service.
* **entrypoint.sh**: this file is entrypoint for docker service.

### Important Notes:

* Depending on service itself, there may be more files present that are required for service to function i.e.
  supervisord, nginx and php-fpm configurations.
* Services also have access to out of scope directories such as `./tmp`, `./config`, `./storage`, `./emails` and a
  sub-directory corresponding to service in `./log`. These directories are loaded as volumes on docker containers.

# Binaries

Multiple executables are packaged with project to build, restart, maintain services and execute a command on one of the
services.

```
.      
├── bin
│   ├── build.sh             # Build the project
│   ├── engine.sh            # Run a script defined in "engine" service
│   ├── phpmyadmin.sh        # Start/stop PhpMyAdmin service
│   ├── restart.sh           # Restart all or one of the service/container
│   ├── docker.sh            # Execute any docker compose command
│   └── *.sh
```

# Miscellaneous

Remaining of project file/structure. Note that this may not include all the files within project.

```
. 
├── config              # Configuration files 
├── docker              # Docker Compose files
├── docs                # All app/project documentation files
├── logs
│   ├── admin                      # Log directory for "admin_api" service
│   │   ├── access.log             # Nginx access log file
│   │   └── error.log              # Nginx error log file
│   ├── engine                     # Log directory for "engine" service
│   │   └── error.log              # Error log
│   ├── public                     # Log directory for "public_api" service
│   │   ├── access.log             # Nginx access log file
│   │   └── error.log              # Nginx error log file
├── ssl                    # Any SSL/TLS certification/private key files          
├── storage
│   ├── alerts             # Directory reserved for system generated notifications/alerts (reviewed in Administration interface)
│   ├── data                       
│   │   ├── countries.tsv          # List of countries (names, ISO Alpha-2, ISO Alpha-3 and dial codes)
│   │   └── **
│   tmp
│   ├── admin             
│   │   ├── sessions      # All administration sessions are archived in this directory
│   │   └── **
│   ├── semaphore         # Directory used for semaphore locks
│   └── **
│   .env                  # Master environment configuration file used by App and Docker
│   .gitignore
```
